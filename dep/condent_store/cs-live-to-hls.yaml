apiVersion: v1
kind: ConfigMap
metadata:
  name: cs-live-to-hls-config
data:
  CHANNEL_NAME: "test channel"
  CHANNEL_LIVE: "true"
  CHANNEL_DAILY_START: "00:00"
  CHANNEL_DAILY_STOP: "23:59"
  CHANNEL_URL: "https://tv.razavi.ir/hls/rozeh_1.m3u8"
  CHANNEL_BANDWIDTH: "1000000"
  HLS_VIDEO_CODEC: "copy"
  HLS_VIDEO_SIZE: "1280x720"
  HLS_VIDEO_FPS: "25"
  HLS_AUDIO_CODEC: "copy"
  HLS_AUDIO_BITRATE: "128k"

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: cs-live-to-hls-dep
  labels:
    tire: channel
    topic: hls
spec:
  selector:
    matchLabels:
      app: cs-live-to-hls
  replicas: 1
  template:
    metadata:
      labels:
        app: cs-live-to-hls
        topic: hls
    spec:
      volumes:
        - name: hls-out
          emptyDir:
            medium: "Memory"

      containers:
        - name: cs-live-to-hls
          image: cs-live-to-hls
          
          volumeMounts:
            - name: hls-out
              mountPath: /hls
          envFrom:
            - configMapRef:
                name: cs-gb-mq-config
            - configMapRef:
                name: cs-live-to-hls-config
      initContainers:
        - name: wait-for-mq
          image: busybox:1.28
          
          command: ['sh', '-c', "until nslookup $CS_GB_MQ_SERVICE_HOST; do echo \
'Wait for gb-mq'; sleep 3; done"]
          envFrom:
            - configMapRef:
                name: cs-gb-mq-config
